# Настройка GigaChat

## Регистрация и получение API ключа

1. **Создайте Сбер ID** (если еще нет):
   - Перейдите на https://sberid.ru/
   - Зарегистрируйтесь или войдите

2. **Создайте проект GigaChat API**:
   - Перейдите на https://developers.sber.ru/gigachat
   - Войдите через Сбер ID
   - Создайте новый проект GigaChat API

3. **Получите ключ авторизации**:
   - В интерфейсе проекта перейдите в раздел "Настройки API"
   - Нажмите "Получить ключ"
   - **ВАЖНО**: Сохраните значение поля "Authorization Key" - оно отображается только один раз!

## Настройка в проекте

### 1. Установка зависимостей

Зависимость `gigachat` уже добавлена в `pyproject.toml`. Установите её:

```bash
make install
```

Или напрямую:

```bash
uv pip install gigachat
```

### 2. Настройка переменных окружения

Создайте или обновите файл `.env`:

```env
# GigaChat настройки
LLM_PROVIDER=gigachat
OPENAI_API_KEY=your_gigachat_authorization_key_here
# LLM_MODEL не используется для GigaChat, но можно оставить для совместимости
LLM_MODEL=GigaChat

# RAGAS LLM (использует те же настройки)
RAGAS_LLM_MODEL=GigaChat
```

**Важно:**
- `LLM_PROVIDER=gigachat` - указывает, что нужно использовать GigaChat
- `OPENAI_API_KEY` - здесь указывается ключ авторизации GigaChat (название переменной оставлено для совместимости)
- `LLM_MODEL` - не используется для GigaChat, но можно указать для совместимости

### 3. Установка корневого сертификата (опционально)

Для корректной работы с GigaChat API может потребоваться установка корневого сертификата НУЦ Минцифры:

```bash
curl -k "https://gu-st.ru/content/Other/doc/russian_trusted_root_ca.cer" -w "\n" >> $(python -m certifi)
```

**Примечание:** В коде используется `verify_ssl_certs=False`, поэтому установка сертификата может не потребоваться.

## Проверка работы

### 1. Тест LLM

```bash
uv run python scripts/test_llm.py
```

Если все настроено правильно, вы должны увидеть успешный ответ от GigaChat.

### 2. Запуск бота

```bash
make run
```

Отправьте сообщение боту в Telegram - он должен отвечать через GigaChat.

### 3. Запуск evaluation

```bash
make reindex-and-evaluate
```

Evaluation будет использовать GigaChat для генерации ответов и вычисления метрик.

## Особенности GigaChat

1. **Оптимизация для русского языка**: GigaChat специально оптимизирован для работы с русским языком, что делает его идеальным выбором для российских проектов.

2. **Работает в России**: GigaChat доступен из России без необходимости использования VPN.

3. **Бесплатный tier**: Есть бесплатный tier с ограничениями по количеству запросов.

4. **Интеграция**: В проекте создана обертка для использования GigaChat как ChatModel в LangChain, что позволяет использовать его в RAG-цепочках.

## Известные ограничения

1. **Формат API**: GigaChat использует свой формат API, не совместимый с OpenAI. В проекте создана обертка для совместимости.

2. **Асинхронность**: GigaChat библиотека работает синхронно, поэтому асинхронные вызовы выполняются через executor.

3. **RAGAS**: Для RAGAS используется GigaChat напрямую как LLM (не ChatModel), что поддерживается библиотекой.

## Документация

- Официальная документация GigaChat API: https://developers.sber.ru/docs/ru/gigachat/api/reference
- GitHub репозиторий библиотеки: https://github.com/ai-forever/gigachat


