# Настройка OpenGate LLM API

## О OpenGate

OpenGate - это российский сервис, предоставляющий доступ к различным LLM моделям через OpenAI-совместимый API. Работает в России без VPN.

**Преимущества:**
- ✅ Работает в России без VPN
- ✅ OpenAI-совместимый API (легкая интеграция)
- ✅ Доступ к различным моделям (Gemini, Grok, DeepSeek, Qwen, Mistral, Llama)
- ✅ Не требует кастомной интеграции

## Регистрация и получение API ключа

### Шаг 1: Откройте сайт OpenGate

1. Перейдите на https://opengatellm.ru/
2. Изучите доступные модели в каталоге: https://opengatellm.ru/catalog.html

### Шаг 2: Регистрация

1. **Найдите кнопку регистрации:**
   - Обычно это "Регистрация", "Sign Up", "Создать аккаунт" или "Войти"
   - Может быть в правом верхнем углу или на главной странице

2. **Заполните форму регистрации:**
   - Укажите email или телефон
   - Придумайте пароль
   - Подтвердите регистрацию (может потребоваться подтверждение email/телефона)

3. **Войдите в аккаунт:**
   - Используйте созданные учетные данные для входа

### Шаг 3: Получение API ключа

1. **Перейдите в личный кабинет:**
   - После входа найдите раздел "API", "API Keys", "Ключи API" или "Настройки API"
   - Может быть в меню профиля или в разделе "Разработчикам"

2. **Создайте API ключ:**
   - Нажмите "Создать ключ", "Generate API Key" или аналогичную кнопку
   - Возможно, потребуется указать название проекта или описание

3. **Сохраните ключ:**
   - ⚠️ **ВАЖНО**: API ключ отображается только один раз при создании
   - Скопируйте ключ и сохраните его в безопасном месте
   - Не делитесь ключом публично

### Если не можете найти регистрацию

Если на сайте opengatellm.ru нет явной регистрации, попробуйте:

1. **Проверьте раздел "Документация"** или "API" - там может быть информация о регистрации
2. **Свяжитесь с поддержкой** через контакты на сайте
3. **Используйте альтернативу** - LLMost (https://llmost.ru/) - похожий сервис с более простой регистрацией

## Настройка в проекте

### 1. Обновите файл `.env`

Добавьте следующие переменные:

```env
# OpenGate настройки
LLM_PROVIDER=openai
OPENAI_BASE_URL=https://api.opengatellm.ru/v1
LLM_MODEL=llama-3.1-8b-instruct
OPENAI_API_KEY=your_opengate_api_key_here

# RAGAS LLM (использует те же настройки)
RAGAS_LLM_MODEL=llama-3.1-8b-instruct
```

**Важно:**
- `LLM_PROVIDER=openai` - используем стандартный OpenAI-совместимый провайдер
- `OPENAI_BASE_URL=https://api.opengatellm.ru/v1` - endpoint OpenGate
- `LLM_MODEL` - выберите модель из доступных в OpenGate
- `OPENAI_API_KEY` - ваш API ключ от OpenGate

### 2. Доступные модели в OpenGate

Проверьте актуальный список моделей на сайте OpenGate. Примеры:
- `llama-3.1-8b-instruct`
- `llama-3.1-70b-instruct`
- `qwen-2.5-7b-instruct`
- `mistral-7b-instruct`
- `gemini-pro`
- `grok-beta`

### 3. Проверка работы

#### Тест LLM:

```bash
uv run python scripts/test_llm.py
```

Если все настроено правильно, вы должны увидеть успешный ответ от OpenGate.

#### Запуск бота:

```bash
make run
```

Отправьте сообщение боту в Telegram - он должен отвечать через OpenGate.

#### Запуск evaluation:

```bash
make reindex-and-evaluate
```

Evaluation будет использовать OpenGate для генерации ответов и вычисления метрик.

## Преимущества OpenGate

1. **Простая интеграция**: OpenAI-совместимый API означает, что не нужны изменения в коде
2. **Работает в России**: Доступен из России без VPN
3. **Разнообразие моделей**: Доступ к различным LLM моделям
4. **Бесплатный tier**: Есть бесплатный tier с ограничениями

## Известные ограничения

1. **Rate limits**: Могут быть ограничения по количеству запросов в минуту/час
2. **Модели**: Доступность моделей может изменяться - проверяйте актуальный список на сайте
3. **Латентность**: Может быть немного медленнее, чем прямые API провайдеров

## Документация

- Сайт OpenGate: https://opengatellm.ru/
- Каталог моделей: https://opengatellm.ru/catalog.html

## Альтернативы (если OpenGate недоступен)

Если OpenGate не работает или регистрация недоступна, можно использовать:

### 1. LLMost (рекомендуется как альтернатива)

**Регистрация:**
1. Перейдите на https://llmost.ru/
2. Зарегистрируйтесь (обычно простая регистрация через email)
3. Получите API ключ в личном кабинете

**Настройка в `.env`:**
```env
LLM_PROVIDER=openai
OPENAI_BASE_URL=https://api.llmost.ru/v1
LLM_MODEL=gpt-3.5-turbo
OPENAI_API_KEY=your_llmost_api_key_here
RAGAS_LLM_MODEL=gpt-3.5-turbo
```

### 2. GigaChat (российский, от Сбера)

**Регистрация:**
1. Перейдите на https://developers.sber.ru/gigachat
2. Войдите через Сбер ID
3. Создайте проект и получите Authorization Key

**Настройка в `.env`:**
```env
LLM_PROVIDER=gigachat
OPENAI_API_KEY=your_gigachat_authorization_key_here
LLM_MODEL=GigaChat
RAGAS_LLM_MODEL=GigaChat
```

Подробная инструкция: `docs/gigachat-setup.md`

### 3. Yandex GPT

**Регистрация:**
1. Перейдите на https://yandex.cloud/
2. Создайте аккаунт
3. Получите API ключ в разделе Foundation Models

**Настройка:** Требует кастомную интеграцию (не OpenAI-совместимый)

