# Проверка ролей сервисного аккаунта

## Проблема
Ошибка: `PermissionDenied desc = Permission to [resource-manager.folder b1gmr1r78ff0f9n3qbbk...] denied`

Это означает, что у сервисного аккаунта нет прав на каталог.

## Пошаговая проверка

### Шаг 1: Откройте страницу сервисного аккаунта

1. Перейдите в Yandex Cloud Console
2. Откройте: **IAM** → **Сервисные аккаунты**
3. Найдите и откройте сервисный аккаунт `speechkit-bot`

### Шаг 2: Найдите правильную вкладку

**ВНИМАНИЕ:** Есть две разные вкладки:
- **"Права доступа"** (Access Rights) - показывает, кто имеет доступ К сервисному аккаунту (это НЕ то, что нужно)
- **"Роли"** (Roles) - показывает, какие роли НАЗНАЧЕНЫ сервисному аккаунту (это то, что нужно!)

1. В левом меню найдите и нажмите на вкладку **"Роли"** (Roles)
   - Если вкладки "Роли" нет, она может называться "Access Rights" или быть в другом месте
   - Ищите вкладку, которая показывает роли, назначенные сервисному аккаунту, а не права доступа к нему
2. Проверьте список ролей

### Шаг 3: Что должно быть

**Правильно:**
- Роль `ai.speechkit-stt.user` назначена на **каталог** `default` (ID: `b1gmr1r78ff0f9n3qbbk`)
- В списке ролей должно быть указано: `ai.speechkit-stt.user` на уровне `folder`

**Неправильно:**
- Роль назначена на **облако** (cloud) - это не подходит
- Роль назначена на **организацию** (organization) - это не подходит
- Роли нет вообще

### Шаг 4: Назначьте роль правильно

Если роль не назначена или назначена неправильно:

1. Нажмите кнопку **Назначить роли** (или "Добавить роль", "Assign roles")
2. В выпадающем списке выберите **Каталог** (Folder), а не Облако или Организацию
3. Выберите каталог `default` (ID: `b1gmr1r78ff0f9n3qbbk`)
4. В списке ролей найдите и выберите `ai.speechkit-stt.user`
5. Нажмите **Сохранить** или **Назначить**

### Шаг 5: Если роль уже назначена на облако/организацию

1. Найдите роль `ai.speechkit-stt.user` в списке
2. Проверьте, на каком уровне она назначена
3. Если она назначена на облако/организацию, удалите её
4. Назначьте роль заново, но на каталог `default`

### Шаг 6: Проверьте результат

После назначения роли:

1. Убедитесь, что в списке ролей видно:
   - Роль: `ai.speechkit-stt.user`
   - Уровень: `folder` / `каталог`
   - Ресурс: `default` (ID: `b1gmr1r78ff0f9n3qbbk`)

2. Запустите тест снова:
   ```bash
   uv run python test_speechkit.py
   ```

3. Если тест показывает статус 200 или 400 - всё работает!

## Альтернативное решение

Если проблема сохраняется, можно попробовать:

1. **Удалить и пересоздать сервисный аккаунт** в нужном каталоге
2. **Использовать IAM-токен** вместо API-ключа с областью действия (но это сложнее)

## Визуальная подсказка

В интерфейсе Yandex Cloud при назначении роли должно выглядеть так:

```
Уровень: [Каталог ▼]  ← Выберите "Каталог", не "Облако" или "Организация"
Каталог: [default (b1gmr1r78ff0f9n3qbbk) ▼]
Роль:    [ai.speechkit-stt.user ▼]
```

## Дополнительная проверка

Также убедитесь, что:
- Сервисный аккаунт создан в каталоге `default` (ID: `b1gmr1r78ff0f9n3qbbk`)
- API-ключ создан для этого сервисного аккаунта
- API-ключ имеет область действия `yc.ai.speechkitStt.execute`

